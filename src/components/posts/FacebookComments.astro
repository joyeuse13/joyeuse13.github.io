---
interface Props {
    numPosts?: number;
}

const {numPosts = 5} = Astro.props;
import { getSiteConfig } from "../../scripts/getSiteConfig";

const siteConfig = await getSiteConfig();
const fbAppId = siteConfig.facebook.app_id;
const href = Astro.request.url.toString();
console.log("FB-URL:", href);

---
{ siteConfig.facebook.include &&
    <div class="w-full h-fit">
        <div id="fb-root" />
        <script is:inline async defer
                crossorigin="anonymous"
                src=`https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v22.0&appId=${fbAppId}` />

        <div class="fb-comments"
             data-colorscheme="light"
             data-href={href}
             data-width="100%"
             data-numposts={numPosts} />
    </div>

    <script is:inline>

        function setTheme() {
            const fbComments = (document.querySelectorAll(".fb-comments")[0]);
            if (fbComments) {
                let theme = localStorage.getItem('theme');
                const themeSet = localStorage.getItem('themeSet');
                if (themeSet) {
                    fbComments.dataset.colorscheme = theme;
                }

            }
        }

        // if user hasn't manually set theme, we can respond to system theme
        // set up theming
        const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkModeMediaQuery.addEventListener('change', (e) => {
            const themeSet = localStorage.getItem('themeSet');
            console.log('ThemedImage: themeSet', themeSet);
            if (!themeSet) {
                setTheme();
            }
        });
    </script>
 }
