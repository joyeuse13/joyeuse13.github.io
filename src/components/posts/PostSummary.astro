---
interface Props {
    post: any
}

import FormattedDate from "../FormattedDate.astro";
import { Image } from 'astro:assets';
import getPostData from "../../utils/getPostData";
import getImageMetadata from "../../utils/getImageMetadata";
import {getSiteConfig} from "../../utils/getSiteConfig";
import toSafeId from '../../utils/toSafeId';

const siteConfig = await getSiteConfig();

const post = Astro.props.post;

const { path } = getPostData(post);
const href = `/${siteConfig.blog.prefix}${path}/`;

const { frontmatter } = post;
console.log("post", frontmatter);
const { title, publishDate, description, thumbnail:thumbnailSrc = null} = frontmatter;
const id = toSafeId("post-summary");
const imgId = `${id}-img`;
---

<li>
    <div class="flex flex-row">
        <!-- post thumbnail -->
        {thumbnailSrc && (

            <div class="post-thumbnail-wrapper hidden lg:block">
                    <Image id={imgId} src={getImageMetadata(thumbnailSrc)} alt={title} class="post-thumbnail" />
            </div>
        )}
        <!-- post summary text -->
        <div id={id} class="post-summary-wrapper h-fit align-top">
            <div class="post-item">
                <div class="flex flex-row"></div>
                <h3 class="post-list-title">
                    <a href={href}>{title}</a>
                </h3>

                <span class="post-item-date">
                      <FormattedDate date={publishDate} />
                </span>
                <p>{description}</p>
            </div>
            <div class="post-item-footer">
                <a class="post-link" href={href}>Read more Â»</a>
            </div>
        </div>
    </div>
</li>

<script is:inline define:vars={{id, imgId}} data-astro-rerun>
    const img = document.getElementById(imgId);
    if (img) {
        const summary = document.getElementById(id);
        const imgSize = `${summary.offsetHeight}px`;

        img.parentElement.style.minWidth = imgSize;
        img.parentElement.style.minHeight = imgSize;
        img.style.minWidth = imgSize;
        img.style.minHeight = imgSize;
        img.classList.remove('hidden');
    }
</script>
